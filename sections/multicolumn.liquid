{{ 'section-multicolumn.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{%- liquid
  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and section.blocks.size > columns_mobile_int
    assign show_mobile_slider = true
  endif
-%}

<div class="multicolumn color-{{ section.settings.color_scheme }} gradient{% unless section.settings.background_style == 'none' and settings.text_boxes_border_thickness > 0 or settings.text_boxes_shadow_opacity > 0 %} background-{{ section.settings.background_style }}{% endunless %}{% if section.settings.title == blank %} no-heading{% endif %}"
   style="background-image:url('https://cdn.shopify.com/s/files/1/0319/7606/3111/files/bg_2.png?v=1737718981');background-attachment: scroll;
    background-repeat: no-repeat;background-size: cover;"
  >
  <div
    class="page-width section-{{ section.id }}-padding isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
    {% if settings.animations_reveal_on_scroll %}
      data-cascade
    {% endif %}
  >

    {%- unless section.settings.title == blank -%}
      <div class="title-wrapper-with-link title-wrapper--self-padded-mobile title-wrapper--no-top-margin multicolumn__title">
         <p class="subheading">
          {{ section.settings.subheading }}
        </p>
        <h2 class="title inline-richtext {{ section.settings.heading_size }}">
          {{ section.settings.title }}
        </h2>
        {%- if section.settings.button_label != blank and show_mobile_slider -%}
          <a href="{{ section.settings.button_link }}" class="link underlined-link large-up-hide">
            {{- section.settings.button_label | escape -}}
          </a>
        {%- endif -%}
      <div class="section-qutes">
        <svg width="40" height="26" viewBox="0 0 40 26" fill="none" xmlns="http://www.w3.org/2000/svg">
        <mask id="mask0_10987_3483" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="40" height="26">
        <path d="M39.9202 25.5771L0 25.5771L-2.19708e-06 0.445507L39.9202 0.445504L39.9202 25.5771Z" fill="white"/>
        </mask>
        <g mask="url(#mask0_10987_3483)">
        <path d="M39.801 17.1789C39.6934 17.9472 39.4706 18.6877 39.2276 19.4232C37.8693 23.5485 33.9415 26.0371 29.6516 25.4915C25.5276 24.9662 22.1693 21.4017 21.9744 17.2561C21.8035 13.6042 23.2592 10.7637 26.4022 8.8359C26.5769 8.72831 26.6453 8.61818 26.62 8.40679C26.4934 7.34223 26.2453 6.31185 25.7643 5.34982C25.2048 4.23084 24.3959 3.39286 23.1503 3.02577C22.4757 2.82704 22.1111 2.19919 22.2187 1.55109C22.3263 0.894129 22.8529 0.458687 23.5693 0.447294C24.3465 0.435901 25.1174 0.501724 25.8845 0.623243C30.6048 1.36881 34.4453 3.55362 37.1858 7.52957C38.8427 9.9359 39.8896 12.5562 39.9149 15.5219C39.9415 16.0789 39.8782 16.6308 39.801 17.1789Z" fill="#F77F9E"/>
        <path d="M7.61585 25.49C2.75382 24.8279 -0.762631 19.9381 0.142434 15.1279C0.661419 12.3722 2.08673 10.2608 4.50319 8.83044C4.67028 8.73044 4.71711 8.63424 4.69559 8.43677C4.59939 7.55196 4.40572 6.68993 4.06901 5.86841C3.51205 4.50639 2.65635 3.44816 1.16395 3.01525C0.5399 2.83424 0.186735 2.17981 0.291798 1.57981C0.406988 0.922846 0.91585 0.476009 1.588 0.458288C2.36521 0.4393 3.1361 0.507656 3.90445 0.626642C8.70445 1.37095 12.5943 3.60132 15.3475 7.66588C16.9525 10.0368 17.9703 12.614 17.9905 15.5203C18.0108 16.852 17.731 18.1229 17.3184 19.3824C15.9386 23.59 11.9918 26.0849 7.61585 25.49Z" fill="#F77F9E"/>
        </g>
        </svg>
      </div>
      </div>
    {%- endunless -%}
    <div class="slider-container">
      <ul
        class="custom-slider multicolumn-list contains-content-container grid grid--{{ section.settings.columns_mobile }}-col-tablet-down grid--{{ section.settings.columns_desktop }}-col-desktop"
        id="Slider-{{ section.id }}"
        role="list"
      >
        {%- liquid
          assign highest_ratio = 0
          for block in section.blocks
            if block.settings.image.aspect_ratio > highest_ratio
              assign highest_ratio = block.settings.image.aspect_ratio
            endif
          endfor
        -%}
        {%- for block in section.blocks -%}
          {%- assign empty_column = '' -%}
          {%- if block.settings.image == blank
            and block.settings.title == blank
            and block.settings.text == blank
            and block.settings.link_label == blank
          -%}
            {%- assign empty_column = ' multicolumn-list__item--empty' -%}
          {%- endif -%}

          <li
            id="Slide-{{ section.id }}-{{ forloop.index }}"
            class="custom-slide multicolumn-list__item grid__item {% if section.settings.column_alignment == 'center' %} center{% endif %}{{ empty_column }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
            {{ block.shopify_attributes }}
            {% if settings.animations_reveal_on_scroll %}
              data-cascade
              style="--animation-order: {{ forloop.index }};"
            {% endif %}
          >
            <div class="multicolumn-card content-container">
              {%- if block.settings.image != blank -%}
                {% if section.settings.image_ratio == 'adapt' or section.settings.image_ratio == 'circle' %}
                  {% assign spaced_image = true %}
                {% endif %}
                <div class="multicolumn-card__image-wrapper multicolumn-card__image-wrapper--{{ section.settings.image_width }}-width{% if section.settings.image_width != 'full' or spaced_image %} multicolumn-card-spacing{% endif %}">
                 {% comment %}
                   
                
                  <div
                    class="media media--transparent media--{{ section.settings.image_ratio }}"
                    {% if section.settings.image_ratio == 'adapt' %}
                      style="padding-bottom: {{ 1 | divided_by: highest_ratio | times: 100 }}%;"
                    {% endif %}
                  >
                    {%- liquid
                      assign number_of_columns = section.settings.columns_desktop
                      assign number_of_columns_mobile = section.settings.columns_mobile
                      assign grid_space_desktop = number_of_columns | minus: 1 | times: settings.spacing_grid_horizontal | plus: 100 | append: 'px'
                      assign grid_space_tablet = number_of_columns_mobile | minus: 1 | times: settings.spacing_grid_horizontal | plus: 100 | append: 'px'
                      assign grid_space_mobile = number_of_columns_mobile | minus: 1 | times: settings.spacing_grid_horizontal | divided_by: 2 | plus: 30 | append: 'px'
                      if section.settings.image_width == 'half'
                        assign image_width = 0.5
                      elsif section.settings.image_width == 'third'
                        assign image_width = 0.33
                      else
                        assign image_width = 1
                      endif
                    -%}
                    {% capture sizes %}
                      (min-width: {{ settings.page_width }}px) calc(({{ settings.page_width }}px - {{ grid_space_desktop }}) * {{ image_width }} /  {{ number_of_columns }}),
                      (min-width: 990px) calc((100vw - {{ grid_space_desktop }}) * {{ image_width }} / {{ number_of_columns }}),
                      (min-width: 750px) calc((100vw - {{ grid_space_tablet }}) * {{ image_width }} / {{ number_of_columns_mobile }}),
                      calc((100vw - {{ grid_space_mobile }}) * {{ image_width }} / {{ number_of_columns_mobile }})
                    {% endcapture %}
                    {{
                      block.settings.image
                      | image_url: width: 3200
                      | image_tag:
                        widths: '50, 75, 100, 150, 200, 300, 400, 500, 750, 1000, 1250, 1500, 1750, 2000, 2250, 2500, 2750, 3000, 3200',
                        sizes: sizes,
                        class: 'multicolumn-card__image'
                    }}
                  </div>
                 {% endcomment %}
                </div>
              {%- endif -%}
              <div class="multicolumn-card__info">
                 {%- if block.settings.text != blank -%}
                  <div class="rte h4">{{ block.settings.text }}</div>
                {%- endif -%}
                <div class="rating">
                 {{ block.settings.html }}
                </div>                
                {%- if block.settings.title != blank -%}
                  <h3 class="inline-richtext h5">{{ block.settings.title }}</h3>
                {%- endif -%}
                {%- if block.settings.link_label != blank -%}
                  <a
                    class="link animate-arrow"
                    {% if block.settings.link == blank %}
                      role="link" aria-disabled="true"
                    {% else %}
                      href="{{ block.settings.link }}"
                    {% endif %}
                  >
                    {{- block.settings.link_label | escape -}}
                    <span class="svg-wrapper"
                      ><span class="icon-wrap">&nbsp;{{ 'icon-arrow.svg' | inline_asset_content }}</span></span
                    >
                  </a>
                {%- endif -%}
              </div>
            </div>
          </li>
        {%- endfor -%}
      </ul>
        <div class="slider-buttons">
          <button
            type="button"
            class="slider-button slider-button--prev multi-button-prev"
            name="previous"
            aria-label="{{ 'general.slider.previous_slide' | t }}"
          >
            <span class="svg-wrapper">
            <svg width="49" height="14" viewBox="0 0 49 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M47.4863 6.96533H0.972656" stroke="#F77F9E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6.39449 12.3871L0.972656 6.96529L6.39449 1.54346" stroke="#F77F9E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            </span>
          </button>
              <div class="custom-dots">
                {% for block in section.blocks %}                  
                 {%- if block.settings.image != blank %}
                  <img class="dot" src="{{ block.settings.image | img_url:"small" }}">
                {% endif %}
              {% endfor %}
              </div>
          <button
            type="button"
            class="slider-button slider-button--next multi-button-next"
            name="next"
            aria-label="{{ 'general.slider.next_slide' | t }}"
          >
               <span class="svg-wrapper">
               <svg width="48" height="13" viewBox="0 0 48 13" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1.48633 7.04346H48" stroke="#F77F9E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M42.5782 12.4652L48 7.04341L42.5782 1.62158" stroke="#F77F9E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
          </button>
        </div>
    </div>
    <div class="center{% if show_mobile_slider %} small-hide medium-hide{% endif %}">
      {%- if section.settings.button_label != blank -%}
        <a
          class="button button--primary"
          {% if section.settings.button_link == blank %}
            role="link" aria-disabled="true"
          {% else %}
            href="{{ section.settings.button_link }}"
          {% endif %}
        >
          {{ section.settings.button_label | escape }}
        </a>
      {%- endif -%}
    </div>
  </div>
</div>

<script>
class Slider {
  constructor(sliderElement, prevButton, nextButton, dotsContainer) {
    this.sliderElement = sliderElement;
    this.slides = sliderElement.children;
    this.prevButton = prevButton;
    this.nextButton = nextButton;
    this.dotsContainer = dotsContainer;
    this.currentIndex = 0;
    this.totalSlides = this.slides.length;   
    this.dots = this.dotsContainer.children;
    
    // this.createDots();
    this.updateSlider();

    this.prevButton.addEventListener('click', () => this.moveSlide(-1));
    this.nextButton.addEventListener('click', () => this.moveSlide(1));
    this.dotsContainer.addEventListener('click', (e) => this.dotClick(e));
  }

  createDots() {
    for (let i = 0; i < this.totalSlides; i++) {
      const dot = document.createElement('span');
      dot.classList.add('dot');
      this.dotsContainer.appendChild(dot);
    }
    this.dots = this.dotsContainer.children;
  }

  updateSlider() {
    this.sliderElement.style.transform = `translateX(-${this.currentIndex * 100}%)`;

    for (let i = 0; i < this.totalSlides; i++) {
      if (i === this.currentIndex) {
        this.dots[i].classList.add('active');
      } else {
        this.dots[i].classList.remove('active');
      }
    }
  }


  moveSlide(step) {
    this.currentIndex += step;

    if (this.currentIndex < 0) {
      this.currentIndex = this.totalSlides - 1;
    } else if (this.currentIndex >= this.totalSlides) {
      this.currentIndex = 0;
    }
    this.updateSlider();
  }

  dotClick(e) {
    console.log(e);
    if (e.target.classList.contains('dot')) {
      let index;
      for (let i = 0; i < this.dots.length; i++) {
        if (this.dots[i] === e.target) {
          index = i;
          break;
        }
      }
      this.currentIndex = index;
      this.updateSlider();
    }
  }
}

const sliderElement = document.querySelector('.custom-slider');
const prevButton = document.querySelector('.multi-button-prev');
const nextButton = document.querySelector('.multi-button-next');
const dotsContainer = document.querySelector('.custom-dots');

const customSlider = new Slider(sliderElement, prevButton, nextButton, dotsContainer);
</script>

{% schema %}
{
  "name": "t:sections.multicolumn.name",
  "class": "section",
  "tag": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "title",
      "default": "t:sections.multicolumn.settings.title.default",
      "label": "t:sections.multicolumn.settings.title.label"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "h1",
          "label": "t:sections.all.heading_size.options__2.label"
        },
        {
          "value": "h0",
          "label": "t:sections.all.heading_size.options__3.label"
        },
        {
          "value": "hxl",
          "label": "t:sections.all.heading_size.options__4.label"
        },
        {
          "value": "hxxl",
          "label": "t:sections.all.heading_size.options__5.label"
        }
      ],
      "default": "h1",
      "label": "t:sections.all.heading_size.label"
    },
    {
      "type": "inline_richtext",
      "id": "subheading",
      "label": "Sub Heading"
    },
    {
      "type": "select",
      "id": "image_width",
      "options": [
        {
          "value": "third",
          "label": "t:sections.multicolumn.settings.image_width.options__1.label"
        },
        {
          "value": "half",
          "label": "t:sections.multicolumn.settings.image_width.options__2.label"
        },
        {
          "value": "full",
          "label": "t:sections.multicolumn.settings.image_width.options__3.label"
        }
      ],
      "default": "full",
      "label": "t:sections.multicolumn.settings.image_width.label"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:sections.multicolumn.settings.image_ratio.options__1.label"
        },
        {
          "value": "portrait",
          "label": "t:sections.multicolumn.settings.image_ratio.options__2.label"
        },
        {
          "value": "square",
          "label": "t:sections.multicolumn.settings.image_ratio.options__3.label"
        },
        {
          "value": "circle",
          "label": "t:sections.multicolumn.settings.image_ratio.options__4.label"
        }
      ],
      "default": "adapt",
      "label": "t:sections.multicolumn.settings.image_ratio.label"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3,
      "label": "t:sections.multicolumn.settings.columns_desktop.label"
    },
    {
      "type": "select",
      "id": "column_alignment",
      "options": [
        {
          "value": "left",
          "label": "t:sections.multicolumn.settings.column_alignment.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.multicolumn.settings.column_alignment.options__2.label"
        }
      ],
      "default": "left",
      "label": "t:sections.multicolumn.settings.column_alignment.label"
    },
    {
      "type": "select",
      "id": "background_style",
      "options": [
        {
          "value": "none",
          "label": "t:sections.multicolumn.settings.background_style.options__1.label"
        },
        {
          "value": "primary",
          "label": "t:sections.multicolumn.settings.background_style.options__2.label"
        }
      ],
      "default": "primary",
      "label": "t:sections.multicolumn.settings.background_style.label"
    },
    {
      "type": "text",
      "id": "button_label",
      "default": "t:sections.multicolumn.settings.button_label.default",
      "label": "t:sections.multicolumn.settings.button_label.label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "t:sections.multicolumn.settings.button_link.label"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.multicolumn.settings.header_mobile.content"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "options": [
        {
          "value": "1",
          "label": "t:sections.multicolumn.settings.columns_mobile.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.multicolumn.settings.columns_mobile.options__2.label"
        }
      ],
      "default": "1",
      "label": "t:sections.multicolumn.settings.columns_mobile.label"
    },
    {
      "type": "checkbox",
      "id": "swipe_on_mobile",
      "default": false,
      "label": "t:sections.multicolumn.settings.swipe_on_mobile.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "t:sections.multicolumn.blocks.column.name",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.multicolumn.blocks.column.settings.image.label"
        },
        {
          "type": "inline_richtext",
          "id": "title",
          "default": "t:sections.multicolumn.blocks.column.settings.title.default",
          "label": "t:sections.multicolumn.blocks.column.settings.title.label"
        },
        {
          "type": "richtext",
          "id": "text",
          "default": "t:sections.multicolumn.blocks.column.settings.text.default",
          "label": "t:sections.multicolumn.blocks.column.settings.text.label"
        },
        {
          "type": "html",
          "id": "html",
          "label": "Rating"
        },
        {
          "type": "text",
          "id": "link_label",
          "label": "t:sections.multicolumn.blocks.column.settings.link_label.label"
        },
        {
          "type": "url",
          "id": "link",
          "label": "t:sections.multicolumn.blocks.column.settings.link.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.multicolumn.presets.name",
      "blocks": [
        {
          "type": "column"
        },
        {
          "type": "column"
        },
        {
          "type": "column"
        }
      ]
    }
  ]
}
{% endschema %}
